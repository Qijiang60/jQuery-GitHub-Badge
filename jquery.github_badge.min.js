/*!
* jQuery GitHub Badge - v0.4 - 9/1/2012
*
* Copyright (c) 2012 Lynn Wallenstein
* Examples and docs at: http://tablesorter.com
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*
* @author Lynn Wallenstein/lynn@lynn.io
* @contributor Rob Garrison/https://github.com/Mottie/
 */
function prettyDate(e){e=new Date((e||"").replace(/-/g,"/").replace(/[TZ]/g," "));e=((new Date).getTime()-e.getTime())/1e3;var t=Math.floor(e/86400),n="Some time ago";switch(!0){case 60>e:n="Just now";break;case 120>e:n="1 minute ago";break;case 3600>e:n=Math.floor(e/60)+" minutes ago";break;case 7200>e:n="1 hour ago";break;case 86400>e:n=Math.floor(e/3600)+" hours ago";break;case 1==t:n="Yesterday";break;case 7>t:n=t+" days ago";break;case 31>t:n=Math.ceil(t/7)+" weeks ago";break;case 366>t:n=Math.floor(t/30)+" months ago";break;case 365<t:n=Math.floor(t/365)+" years ago"}return n}"undefined"!=typeof jQuery&&(jQuery.fn.prettyDate=function(){return this.each(function(){var e=prettyDate($(this).text());e&&$(this).text(e)})});(function(e){if(!window.console){(function(){var t=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],n;window.console={};for(n=0;n<t.length;n=n+1){window.console[t[n]]=e.noop}})()}var t="https://api.github.com/",n='<a target="_blank" href="http://github.com"><img class="github-mark" src="{{image_path}}github.svg" alt="GitHub"></a>',r=['<div class="ghb {{theme}}">','<div class="ghb-header"></div>','<div class="ghb-nav">','<a class="chosen" rel="ghb-info-panel" href="#">User Info</a>','<a rel="ghb-repo-panel" href="#">Repos</a>',"</div>",'<div class="ghb-info-panel ghb-panel" style="display:none;">',"<h2>User Info</h2>","<div></div>","</div>",'<div class="ghb-repo-panel ghb-panel" style="display:none;">',"<h2>Public {{user_badge_title}}</h2>",'<ul class="ghb-repo-list"></ul>','<div class="ghb-goto"></div>',"</div>","</div>"].join(""),i=["<h1>",'<a target="_blank" href="http://github.com/{{login}}">{{login}}\'s GitHub</a> ',"({{public_repos}})","</h1>"].join(""),s=['<img src="{{avatar_url}}" />',"{{name}}","<dl>","<dt>Public Repos:</dt>",'<dd><a target="_blank" href="http://github.com/{{login}}/repositories">{{public_repos}}</a></dd>',"<dt>Followers:</dt>",'<dd><a target="_blank" href="http://github.com/{{login}}/followers">{{followers}}</a></dd>',"<dt>Following:</dt>",'<dd><a target="_blank" href="http://github.com/{{login}}/following">{{following}}</a></dd>',"<dt>Public Gists:</dt>",'<dd><a target="_blank" href="http://gist.github.com/{{login}}">{{public_gists}}</a></dd>',"</dl>"].join(""),o='<a href="http://github.com/{{login}}/repositories">View All {{user_badge_title}} ({{remaining}} More) ... </a>',u='<li class="ghb_user_repo_item"><a target="_blank" href="{{html_url}}">{{name}}</a> <div>{{description}}</div></li>',a='<li data-date="{{pushed_at}}" class="ghb_user_repo_item"><a target="_blank" href="{{html_url}}">{{name}}</a> <div>{{description}}</div></li>',f=['<div class="ghb {{theme}}">','<div class="ghb-header"></div>','<div class="ghb-nav">','<a class="ghb-info-panel_nav chosen" rel="ghb-info-panel"    href="#">Repo Info</a>','<a class="ghb-commit-panel_nav"      rel="ghb-commit-panel"  href="#">Commits</a>','<a class="ghb-repo-panel_nav"       rel="ghb-repo-panel"   href="#">Issues</a>',"</div>",'<div class="ghb-info-panel ghb-panel" style="display:none;"></div>','<div class="ghb-repo-panel ghb-panel" style="display:none;">',"<h2>Open Issues</h2>",'<ul class="ghb-issue-list"></ul>','<div class="ghb-goto ghb-goto-issues"></div>',"</div>",'<div class="ghb-commit-panel ghb-panel" style="display:none;">',"<h2>Commits</h2>",'<ul class="ghb-commit-list">','<li class="no-records">There are no commits in the {{repo_branch}} branch</li>',"</ul>",'<div class="ghb-goto ghb-goto-commits"></div>',"</div>","</div>"].join(""),l=["<p>{{description}}</p>",'<p><a target="_blank" href="http://github.com/{{full_name}}">http://github.com/{{full_name}}</a></p>','<dl class="repo_info_list">',"<dt>Watchers:</dt>","<dd>{{watchers}}</dd>","<dt>Created:</dt>",'<dd class="date">{{created_at}}</dd>',"<dt>Last Updated:</dt>",'<dd class="date">{{pushed_at}}</dd>',"</dl>"].join(""),c=["<li>",'<a target="_blank" href="{{html_url}}">{{title}}<span title="{{login}} @ {{created_at}}">by {{login}}</span></a>',"<div>{{body}}</div>","</li>"].join(""),h=function(e,t){return e.replace(/\{\{([\-_a-z]+)\}\}/g,function(e,n,r){return t[n]||"None"})},p=function(f,l){var c=t+"users/"+l.login+"?callback=?",p=t+"users/"+l.login+"/repos?callback=?",d=e(f).html(h(r,l)),v=d.find(".ghb-header"),m=d.find(".ghb-info-panel"),g=d.find(".ghb-goto"),y=d.find(".ghb-repo-list");e.getJSON(c,function(t){var r=e.extend({},l,t.data);v.html(h(i,r));if(l.include_github_logo){v.prepend(h(n,r))}m.html(h(s,r));if(t.public_repos>l.repo_count){r.remaining=t.public_repos-l.repo_count;g.html(h(o,r))}else{g.html('<a href="http://github.com/'+l.login+'">'+l.login+" at GitHub</a>")}m.show()});e.getJSON(p,function(t){if(t.data.length===0){y.html('<li class="no-records">'+l.login+" Does Not Have Any Repos</li>")}else{var n,r,i=[];e.each(t.data,function(e,t){n=h(l.sort_on==="date"?a:u,t);if(t.fork){n=n.replace('class="','class="ghb_repo_fork ')}i.push(n)});i.sort(function(e,t){e=e.toLowerCase();t=t.toLowerCase();if(e===t){return 0}return e>t?1:-1});if(l.sorting!=="ascending"){i.reverse()}r=l.repo_count-1;n=y.html(i.join("")).children().filter(":gt("+r+")").hide().end().filter(":first").addClass("firstrepo").end().eq(r).addClass("lastrepo").end();if(n.length>r){g.append('<a href="#" class="ghb_show_more">Show '+(n.length-r)+" more</a>").find(".ghb_show_more").click(function(){n.show();this.innerHTML="";return false})}}})},d=function(r,i){var s=t+"repos/"+i.login+"/"+i.repo_name+"?callback=?",o=t+"repos/"+i.login+"/"+i.repo_name+"/issues?state=open&callback=?",u=t+"repos/"+i.login+"/"+i.repo_name+"/commits?callback=?",a=e(r).html(h(f,i)),p=a.find(".ghb-header"),d=a.find(".ghb-info-panel"),v=a.find(".ghb-issue-list"),m=a.find(".ghb-goto-issues").hide(),g=a.find(".ghb-goto-commits").hide(),y=a.find(".ghb-commit-list"),b=y.find(".no_commits");e.getJSON(s,function(t){var r=t.data;p.html('<h1><a target="_blank" href="http://github.com/'+r.full_name+'">'+r.name+"</a></h1>");if(i.include_github_logo){p.prepend(h(n,i))}d.html(h(l,r));m.html('<a href="http://github.com/'+r.full_name+'/issues">View All Issues</a>');g.html('<a href="http://github.com/'+r.full_name+'/commits">View All Commits</a>');d.show();e(".date").prettyDate()});e.getJSON(o,function(t){if(!t.data){v.html('<li class="no-records">There are no open issues for this repo.</li>')}else{m.show();var n=[];e.each(t.data,function(t,r){var s=e.extend({},i,r,r.user);n.push(h(c,s));if(t===i.issue_count-1){return false}});if(i.sorting!=="ascending"){n.reverse()}v.html(n.join("")).children().filter(":first").addClass("firstrepo").end().filter(":last").addClass("lastrepo")}});e.getJSON(u,function(t){var n=[];e.each(t.data,function(e,t){n.push('<li><a target="_blank" href="http://github.com/'+i.login+"/"+i.repo_name+"/commit/"+t.sha+'">'+t.commit.message+'<span title="'+t.committer.login+" @ "+t.commit.committer.date+'">by '+t.committer.login+"</span></a></li>");if(e===i.commit_count-1){return false}});if(i.sorting!=="ascending"){n.reverse()}y.html(n.join("")).children().filter(":first").addClass("firstrepo").end().filter(":last").addClass("lastrepo");g.show()})};e.fn.GitHubBadge=function(t){var n=this;t=jQuery.extend({},e.fn.GitHubBadge.defaults,t);console.group("GitHubBadge");console.log("Options parsed as: %o",t);if(!t.login){console.log("%s",t.login+" is undefined, not doing anything.");return this}if(t.kind==="user"){p(this,t)}else if(t.kind==="project"){if(!t.repo_name){console.log("%s",t.repo_name+" is undefined, not doing anything.");return this}d(this,t)}this.delegate(".ghb-nav a, .ghb-nav a","click",function(r){r.preventDefault();var i=n.find(".chosen").removeClass("chosen").attr("rel"),s=e(this).addClass("chosen").attr("rel");n.find("."+i).hide();n.find("."+s)[t.animate_style==="slide"?"slideDown":"show"]()});this.delegate("ul.ghb-repo-list li, ul.ghb-issue-list li","mouseenter",function(){e(this).find("div").show()});this.delegate("ul.ghb-repo-list li, ul.ghb-issue-list li","mouseleave",function(){e(this).find("div").hide()});console.groupEnd();return this};e.fn.GitHubBadge.defaults={login:null,kind:"user",sort_on:"date",sorting:"ascending",theme:"github",include_github_logo:true,image_path:"images/",animate_style:"slide",user_badge_title:"Repositories",repo_count:"10",show_repos:true,repo_name:null,show_issues:true,issue_count:"10",show_commits:true,commit_count:"10"}})(jQuery)
